# Async-await. Files. C.

![img](https://i.morioh.com/2019/11/22/2c2bb91c6e2b.jpg)

## Async-await

Начнем с того, что поймем - асинхронное программирование (т. е. возможность программы выполнять несколько действий одновременно) очень мощный инструмент, который очень помогает при решении ряда задач: взаимодействие клиентов и сервера, гейм-дев и т. д.

Основную концепцию асинхронного программирования можно представить так:

```python
Event loop:
    coroutine1 -> task1
    coroutine2 -> task2
    ...
    coroutineN -> taskN
```

У нас есть некоторый цикл событий, принцип которого заключается в следующем: **На очередное событие необходимо ответить соотв. функцией**

Давайте дадим несколько важных определений:

**Сопрограммы (Coroutines)** - это функции, которые приостанавливаются в разных точках;

**Цикл событий (Event loop)** - цикл, в котором планируется запуск сопрограмм, а также они выполняются.

Как раз таки эти инструменты позволяют нам писать асинхронный код, который будет выглядеть также, как и синхронный.

**Многозадачность** — это то, что ваша операционная система делает с вашими процессами. Она решает, какое действие справедливо, кто занимает процессор, когда выполнять ввод/вывод данных и т. д. Цикл событий, однако, предоставляет возможность кооперативной многозадачности, при которой сопрограммы указывают, когда готовы стартовать и останавливаться. Они работают в одном потоке, поэтому вы не столкнетесь с различными потенциальными проблемами.

Зачастую огромное количество решений нам дает библиотека **asyncio**.

Благодаря размещению сопрограмм в вашей программе вы можете "контролировать" асинхронное программирование. Вызвать сопрограмму можно:

* Путем размещения ключевого слова await перед ее именем в коде, что поместит сопрограмму в существующий цикл обработки событий. Вы можете сделать это только внутри другой сопрограммы;

* можно также использовать конструкцию asyncio.run(), которая явно запускает цикл обработки событий;
* помимо этого, можно воспользоваться вызовами asyncio.create_task() или asyncio.ensure_future().

Рассмотрим какой-нибудь пример. Пусть у нас программа в двух вечных циклах будет печатать числа и случайное число раз в полсекунды и две секунды соответственно. Посмотрим внимательно на синтаксис асинхронных функций (сопрограмм):

```python
import asyncio
from random import randint as rnd

async def print_numbers():
    count = 1
    while True:
        print(count)
        count += 1
        await asyncio.sleep(0.5)
        
async def print_random_numbers():
    while True:
        print(rnd(1, 100))
        await asyncio.sleep(2)
        
async def main():
    task1 = asyncio.create_task(print_numbers())
    task2 = asyncio.create_task(print_random_numbers())
    
    await asyncio.gather(task1, task2)
    
if __name__ == "__main__":
    asyncio.run(main())
```

## Работа с файлами

![img](https://vhi.ircdvrd.online/img/619966.jpg)

В Python существует специальные типы для работы с байтами и байтовыми последовательностями: `bytes` и `bytesarray`. Для того, чтобы открыть файл для чтения или записи используйте функцию `open()`, однако не забудьте, что файл является Закрываемым (Closeable) объектом, поэтому не забудьте закрыть его с помощью `close(),` либо используйте менеджер контекста:

```python
with open(filename, mode, ...):
    код
# Файл закроется автоматически
```

### Байты и строки

Прочитайте дополнительную информацию про кодировки, помните, что вы можете кодировать текстовую информацию в байты и декодировать байты в строки с помощью команд: `encode(encoding)` и `decode(encoding)` соответственно.

## С в Python

Мало кто знает, что языки C и C++ и Python тесно [связаны](https://docs.python.org/3/c-api/index.html). Это будет моя последняя фраза в этом курсе.

